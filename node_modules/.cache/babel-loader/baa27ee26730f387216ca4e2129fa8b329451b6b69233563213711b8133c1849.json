{"ast":null,"code":"import axios from \"axios\";\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || \"http://localhost:8080\"\n});\n\n/* ================= REQUEST ================= */\n\napi.interceptors.request.use(config => {\n  if (!(config.data instanceof FormData)) {\n    config.headers[\"Content-Type\"] = \"application/json\";\n  }\n  const token = localStorage.getItem(\"token\");\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n/* ================= RESPONSE ================= */\n\nlet isRefreshing = false;\nlet failedQueue = [];\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(promise => {\n    if (error) promise.reject(error);else promise.resolve(token);\n  });\n  failedQueue = [];\n};\napi.interceptors.response.use(res => res, async err => {\n  var _err$response;\n  const originalRequest = err.config;\n  if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401 && !originalRequest._retry && !originalRequest.url.includes(\"/auth/login\")) {\n    if (isRefreshing) {\n      return new Promise((resolve, reject) => {\n        failedQueue.push({\n          resolve: token => {\n            originalRequest.headers.Authorization = `Bearer ${token}`;\n            resolve(api(originalRequest));\n          },\n          reject\n        });\n      });\n    }\n    originalRequest._retry = true;\n    isRefreshing = true;\n    try {\n      const refreshToken = localStorage.getItem(\"refreshToken\");\n      const res = await axios.post(`${api.defaults.baseURL}/auth/refresh`, {\n        refreshToken\n      });\n      localStorage.setItem(\"token\", res.data.token);\n      api.defaults.headers.Authorization = `Bearer ${res.data.token}`;\n      processQueue(null, res.data.token);\n      return api(originalRequest);\n    } catch (refreshError) {\n      processQueue(refreshError, null);\n      localStorage.clear();\n      window.location.href = \"/login\";\n      return Promise.reject(refreshError);\n    } finally {\n      isRefreshing = false;\n    }\n  }\n  return Promise.reject(err);\n});\nexport default api;","map":{"version":3,"names":["axios","api","create","baseURL","process","env","REACT_APP_API_URL","interceptors","request","use","config","data","FormData","headers","token","localStorage","getItem","Authorization","isRefreshing","failedQueue","processQueue","error","forEach","promise","reject","resolve","response","res","err","_err$response","originalRequest","status","_retry","url","includes","Promise","push","refreshToken","post","defaults","setItem","refreshError","clear","window","location","href"],"sources":["D:/digital-sinagae-project/project/frontend/digital-signage/src/api/services.js"],"sourcesContent":["import axios from \"axios\";\n\nconst api = axios.create({\n  baseURL: process.env.REACT_APP_API_URL || \"http://localhost:8080\",\n});\n\n/* ================= REQUEST ================= */\n\napi.interceptors.request.use((config) => {\n  if (!(config.data instanceof FormData)) {\n    config.headers[\"Content-Type\"] = \"application/json\";\n  }\n\n  const token = localStorage.getItem(\"token\");\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  return config;\n});\n\n/* ================= RESPONSE ================= */\n\nlet isRefreshing = false;\nlet failedQueue = [];\n\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(promise => {\n    if (error) promise.reject(error);\n    else promise.resolve(token);\n  });\n  failedQueue = [];\n};\n\napi.interceptors.response.use(\n  res => res,\n  async err => {\n    const originalRequest = err.config;\n\n    if (\n      err.response?.status === 401 &&\n      !originalRequest._retry &&\n      !originalRequest.url.includes(\"/auth/login\")\n    ) {\n      if (isRefreshing) {\n        return new Promise((resolve, reject) => {\n          failedQueue.push({\n            resolve: token => {\n              originalRequest.headers.Authorization = `Bearer ${token}`;\n              resolve(api(originalRequest));\n            },\n            reject\n          });\n        });\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      try {\n        const refreshToken = localStorage.getItem(\"refreshToken\");\n\n        const res = await axios.post(\n          `${api.defaults.baseURL}/auth/refresh`,\n          { refreshToken }\n        );\n\n        localStorage.setItem(\"token\", res.data.token);\n\n        api.defaults.headers.Authorization =\n          `Bearer ${res.data.token}`;\n\n        processQueue(null, res.data.token);\n\n        return api(originalRequest);\n      } catch (refreshError) {\n        processQueue(refreshError, null);\n\n        localStorage.clear();\n        window.location.href = \"/login\";\n\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    }\n\n    return Promise.reject(err);\n  }\n);\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}